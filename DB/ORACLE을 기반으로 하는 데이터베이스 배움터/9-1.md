# 트랜잭션 개요

데이터베이스 시스템 환경에서 흔히 볼 수 있는 몇 가지 응용의 예를 살펴보자.

```sql
예 1: 전체 사원의 급여를 6% 인상

사원이 500명 재직하고 있는 회사에서 모든 사원의 급여를 6% 인상하는 연산을 데이터베이스의 EMPLOYEE 릴레이션에서 수행한다.

UPDATE		EMPLOYEE
SET			SALARY = SALARY * 1.06;
```

이때 500명 전원의 급여가 수정되거나 한 명의 급여도 갱신되지 않도록 DBMS가 보장해야 한다.  
예를 들어, 아래 그림과 같이 320번째 사원까지 수정한 상태에서 컴퓨터 시스템이 다운된 후에 재기동되었을 때 DBMS는 어떻게 대응해야 하는가?  
위의 수정 연산을 처음부터 다시 수행한다면 320번째까지의 직원의 급여는 두 번 인상되고 321번째 직원부터는 정상적으로 한 번만 인상되는 결과를 가져오므로 이렇게 해서는 안 된다.

DBMS는 항상 현재의 데이터베이스 상태만 유지하므로 각 투플이 수정된 시점을 알 수 없다.  
따라서 DBMS가 추가로 정보를 유지하지 않는다면 DBMS가 재기동된 후에 어느 직원의 투플까지 수정되었는가를 알 수 없다.  
이를 위해 DBMS가 유지하는 __로그(log)__ 에 관해서는 뒤에서 자세하게 논의한다.

![](./image/9-1/ex1.jpg)

```sql
예 2 : 계좌 이체

은행 고객은 자신의 계좌에서 다른 계좌로 송금할 수 있따. 정미림은 자신의 계좌에서 100,000원을 인출하여 안명석의 계좌로 이체하려고 한다.
고객들의 계좌 정보가 ACCOUNT 릴레이션에 들어 있다.

UPDATE		ACCOUNT
SET			BALANCE = BALANCE - 100000
WHERE		CUST_NAME = '정미림';

UPDATE		ACCOUNT
SET			BALANCE = BALANCE + 100000
WHERE		CUST_NAME = '안명석';
```

ACCOUNT 릴레이션에서 정미림의 투플과 안명석의 투플은 서로 상이하므로 하나의 UPDATE문으로 계좌 이체를 표현할 수 없다. 즉 WHERE절에서

CUST_NAME = '정미림' __AND__ CUST_NAME = '안명석'

과 같이 표현하면 이 조건을 만족하는 투플이 하나도 없으며, WHERE절에서

CUST_NAME = '정미림' __OR__ CUST_NAME = '안명석'

과 같이 표현하면 WHERE절을 만족하는 두 개의 투플에 대해 SET절에서 명시한 대로 잔액이 모두 100,000원 증가하거나 100,000원 감소한다.

따라서 위와 같이 두 개의 UPDATE문을 사용하여, 하나의 UPDATE문에서는 정미림의 잔액을 100,000원 감소시키고,  
또 다른 UPDATE문에서는 안명석의 잔액을 100,000원 증가시켜야 한다. 물론 두 UPDATE문의 순서는 중요하지 않다.  
컴퓨터 시스템은 언제든지 다운될 수 있다. 만약 첫 번째 UPDATE문을 수행한 후에 두 번째 UPDATE문을 수행하기 전에 컴퓨터 시스템이 다운되면 재기동한 후에 DBMS는 어떻게 대응해야 하는가?  
위의 두 UPDATE문을 처음부터 다시 수행한다면 정미림의 계좌에서는 100,000원이 두 번 빠져나가게 되므로 총 200,000원이 인출되고,  
안명석의 계좌에는 100,000원만 증가하므로 정미림의 입장에서는 100,000원을 손해보는 것이다.  
만일 DBMS가 아무런 작업을 하지 않는다면 정미림의 계좌에서는 100,000원이 빠져나갔지만 안명석의 계좌에는 100,000원이 증가되지 않았기 때문에 이 또한 안 된다.

위의 두 개의 UPDATE문은 둘 다 완전하게 수행되거나 한 UPDATE문도 수행되어서는 안 되도록, 즉 하나의 __트랜잭션(단위)__처럼 DBMS가 보장해야 한다.  
DBMS는 사용자가 입력하는 SQL문들 중에서 어떤 것들을 하나의 트랜잭션으로 취급해야 하는지 알 수 없다.  
기본적으로 각각의 SQL문이 하나의 트랜잭션으로 취급된다. 따라서 두 개 이상의 SQL문들을 하나의 트랜잭션으로 취급하려면  
사용자가 이를 명시적으로 표시해야 한다. 또한 성공적인 계좌 이체 트랜잭션의 결과는 데이터베이스에 지속적으로 반영되어야 한다.

![](./image/9-1/exampleNumber3-1.jpg)

![](./image/9-1/exampleNumber3-2.jpg)
