# IPv6로 떠나는 여행



## 목차

- IPv6, 왜 필요한 걸까요?
- IPv6의 탄생
- 왜 갑자기 IPv4에서 IPv6로 뛰었을까요?
- IPv6에서 무엇이 달라졌냐고 묻는다면...
- IPv6의 주요 특징에 대한 첫 번째 이야기
- IPv6의 주요 특징에 대한 두 번째 이야기
- IPv6 주소는 어떻게 생겼을까요?
- IPv6와의 어색한 동거
- 라우터에서 IPv6의 구성



## IPv6, 왜 필요한 걸까요?

몇 년 전 하지만 그땐 네트워크가 무엇인지만 알아도 괜찮은 시절이었습니다. 하지만 이젠 네트워크도 너무 방대한 분야로 나뉘었고 또 하루가 다르게 변해가고 있습니다. 정말 하루라도 네트워크에 관한 기술의 발전이 멈춘 날이 없는 것 같습니다.

그 많은 네트워킹 기술 중에서 이번에는 IP version 6에 대한 이야길 들려드릴까 합니다.

몇 년 전부터 들리기 시작한 IP version 6(줄여서 IPv6라고 합니다.)는 벌써 우리와 너무도 가까운 곳에 와 있고, 또 곧 우리 모두에게 몰아닥칠 새로운 IP의 세상입니다.

저와 조금 먼저 IPv6에 대해 알아보고 준비하신다면 아마 낯설게 다가온 IPv6가 조금은 더 친숙하게 느껴지지 않을까 생각합니다.

자, 서론은 여기까지만 하구요. 이야기 시작합니다.

그럼 먼저 IPv6가 왜 나왔는지부터 차근차근 알아보도록 하겠습니다. 이미 눈치채셨겠지만 IPv6의 출현 이유 첫 번째는 IPv4 주소의 주소 공간 부족입니다.

1981년도부터 본격적으로 사용하게 되었던 IP version 4는 1985년에는 전체 주소의 1/16을 사용했으니 그때까지만 해도 주소 부족을 걱정할 필요는 없었을 겁니다. 그런데 1991년 World Wide Web이란 게 개발되고, 1993년엔(이젠 우리의 아련한 기억 속에 웹 브라우저의 할아버지로 기억되고 있는) 모자이크(Mosaic)가 발표되었습니다.  
그러다 보니 IP 주소의 사용이 점점 늘어나게 되면서 1995년에는 전체 주소의 1/3을, 2000년에는 1/2를 사용하게 되었습니다.

아시다시피 IPv4는 32비트 주소 체계니까 이론적으로 2<sup>32</sup> 만큼의 주소를 만들 수 있습니다.

그게 얼마냐구요?

약 43억 개 정도가 됩니다.

그러나 그걸 다 쓸 수는 없답니다. 일단 중간중간에 Private용 등으로 예약된 주소 영역이 있구요. 또 클래스 E는 연구용으로 사용되니 막상 쓸 수 있는 주소는 훨씬 적은 수가 되겠죠. 따라서 현실적으로 배정이 가능한 IP 주소는 약 2억 5,000만 개 정도밖엔 되지 않는다고 합니다.

정말 적죠?

2억 5천만 개가 왜 적냐구요? 그 정도면 충분하지 않냐구요?

그렇지 않습니다.

현재 네트워크의 수는 매년 약 2배로 증가하고 있답니다. 이와 함께 인터넷의 사용자와 장비 역시 기하급수적으로 늘어나고 있습니다.

2001년도 현재 인터넷 사용자 수는 약 4억 2천만 명이라고 하니까 벌써 공인주소의 약 2배 정도의 수가 인터넷을 쓰는 겁니다만, 4억 명이라고 해봐야 전 세계 인구의 1/10도 안 되는 수입니다.  
게다가 중국이나 인도, 러시아 등 인구가 무지하게 많은 나라들이 인터넷을 쓰기 시작했다고 하니, 이제 IP 주소의 부족은 불 보듯 뻔해지게 된 겁니다.

여러분께서도 동의하시죠?

그런데 문제는 이렇게 IP 주소를 사용하는 사람들이 늘어난다는 것이죠. 게다가 기존에 IP 주소를 주로 사용하던 PC나 컴퓨터뿐만 아니라 새로운 장비들이 자꾸 IP 주소를 사용하려고 한다는 것입니다. IP 전화기 아시죠? 언제부턴가 사무실 책상 위에 떡 하니 자리잡기 시작한 IP 전화기는 앞으로 몇 년 내에 일반 전화기들을 몰아낼 기세로 그 세력(?)이 커지고 있답니다.  
게다가 집에서는 인터넷 전화기라는 이름으로 전화기에 IP 주소를 하나씩 붙여서 나타난 애들이 저렴한 통화료를 내세워 집 전화를 집 밖으로 쫓아내기 시작했답니다. "집 나가면 개고생"이라고 하면서 말입니다.

TV도 바뀌고 있죠? IPTV로 말입니다. 그러고 보면 이제 IP란 말은 너무나도 흔하게 사용하는 말이 되어 버렸습니다. 초등학교 애들조차도 "아빠, 우리도 IPTV 설치하자."라고 이야기하는 걸 보면 말입니다.

아무튼 이런 추세라면 IP 주소는 곧 고갈 상태가 된다는 게 현재의 예측이랍니다.

우리에게는 이미 쓸 만한 IPv4 주소는 남아있지 않아 어떤 식으로든 주소 공간 확장에 대한 조치를 내릴 때가 온 겁니다.

이렇게 주소 공간 부족 이외에도 IP version 4의 문제점은 몇 가지 더 있을 수 있습니다.

현재 IP version 4가 가지고 있는 복잡한 헤더(Header)는 전체 필드를 불필요하게 늘리게 했고, 라우터로 하여금 효과적인 헤더 관리를 할 수 없게 한다는 문제를 낳기도 했습니다. 뿐만 아니라 IP 주소 배정 방식이 복잡하다는 문제도 있습니다.  
물론 DHCP(DHCP 다들 아시죠?)를 사용해서 이 문제를 해결할 수 있었지만 또 다른 서버의 구성이라는 오버헤드를 필요로 하게 되었습니다.  
또 주소가 부족하다 보니 주소 배정을 체계적으로 할 수 없어 몇 개의 라우팅 정보를 하나로 묶어주는 Aggregation이 어렵고, 따라서 라우팅 테이블은 점점 더 크고 복잡해질 수밖에 없었습니다.

이 밖에도 번거롭고 효율적이지 못했던 보안 기능과 Mobile IP의 지원 등은 IP version 4에서 해결해줘야 하는 문제점이었습니다.

자, 그렇다면 이떻게 해야 당장 이 문제를 해결할 수 있을까요? 먼저 주소 부족을 해결하기 위한 방법을 알아볼까요? 여러분들이 다 아시는 방법이 하나 있죠?

내부망에서는 Private IP 주소, 즉 내 맘대로 주소를 쓰고 밖으로, 즉 인터넷으로 나갈 때만 공인 IP 주소를 사용하는 겁니다.

이 방법은 이미 오래 전에 흥부네 집에서도 사용을 했던 방법입니다.

가족은 무지 많은데 입고 나갈 옷이 없었던 흥부네 가족은 외출복 몇 벌을 옷걸이에 걸어두고 집에 들어오면 옷을 벗어두고 모두 모여 이불 속에 머리만 내밀고 있다가 밖을 나갈 때만 그 옷을 입고 나가는 겁니다.  
이렇게 하면 가족 모두의 수만큼 옷이 있을 필요가 없겠죠? 밖에 나갈 녀석들만 옷을 입고 갔다 오면 벗어두고 또 다른 애가 나갈 때 그 옷을 입고 나가면 되니까요.

그게 바로 NAT(Network Address Translation)라는 겁니다.

내부에선 Private 주소를 사용하고 인터넷으로 나갈 때만 공인 IP 주소를 쓰게 되면 IP 주소가 몇 개 없어도 인터넷이 가능하다는 장점이 있습니다.

요즘 많이 사용하는 인터넷 공유기 역시 이런 원리를 이용한 것입니다. 하지만 이 방식은 옷이 1인당 하나씩 있을 경우 그냥 그 옷만 입고 나갔다 들어오면 되지만, 옷이 몇 벌 없으니 나갈 때와 들어올 때마다 옷을 갈아입어야 한다는 단점이 있습니다. 따라서 시간이 더 걸리겠죠? 즉 IP 주소를 변환해주는 시간이 필요하다는 겁니다.

그뿐만 아니라 여러 가지 End-to-End 기능을 지원하는 프로그램에서도 호환성에 문제가 있을 수 있습니다. 혹시 기억하시는지 모르겠지만 NAT를 사용할 때 인터넷 전화 프로그램이 간혹 안 되는 경험을 하셨을 겁니다.

이런 NAT라는 방법 이외에도 IPv4에서 주소 공간을 절약하기 위한 대표적인 방법은 바로 서브넷팅이 있습니다.

아시죠? 그 지긋지긋한 서브넷 마스크를 이용한 서브넷팅, 쉽게 말하면 네트워크를 잘게 쪼개 쓴다는 것인데, 주소가 많으면 뭐하러 잘게 쪼개서 쓰겠습니까? 주소가 부족하니까 쓸 만큼 쪼개 쓰고 나머지를 아끼는 거죠.

원래 맨 처음 IPv4 주소가 많았을 땐 서브넷팅이 그리 많이 사용되지 않았지만, 요즘은 서브넷팅 안 하는 곳은 거의 없을 뿐만 아니라 그 쪼개기도 점점 더 정교해졌다는 거죠.

이것 때문에 공부하는 여러분들만 죽을 맛이 된 거구요.

또 안 쓰는 주소는 자동으로 회수하고 주소가 필요한 PC에는 그때그때 주소를 배분해주는 DHCP(Dynamic Host Configuration Protocol)가 있습니다. DHCP를 사용하지 않을 경우 당장 사용을 하지 않는 IP 주소라고 하더라도 그 상태를 파악할 수 없으니 IP 주소 관리가 쉽지 않았던게 사실입니다. 하지만 DHCP를 사용하게 되면서 주소 배정의 편리함뿐만 아니라 안 쓰는 주소를 회수할 수 있어서 주소 낭비를 막을 수 있었습니다.

이 밖에도 클래스 A, B, C와 같은 기존의 약속을 무시하고 뒤에 붙은 서브넷 마스크만 가지고 클래스를 지정하는 방식인 CIDR(Classless Inter Domain Routing)이 있습니다. CIDR은 주로 서브넷팅과 반대 개념인 슈퍼넷팅, 즉 여러 개의 작은 네트워크를 1개로 모아서 라우팅 테이블을 줄여줌으로써 라우터의 메모리를 절약하고 라우팅 속도를 올려주기 위해 사용합니다.

IPv4에서의 주소 부족은 이와 같이 다양하고도 복잡한 주소 관리기법을 만들어냈고 네트워크는 점점 더 복잡해지게 된 겁니다.

자, 지금까지 배운 내용을 정리해볼까요?

현재 우리가 사용하고 있는 인터넷 주소 방식인 IP version 4는 그 사용자가 기하급수적으로 늘어나고, 또 네트워킹을 사용하는 장비가 늘어남으로써 주소 부족 상태를 낳고 있습니다. 현재까지 이 문제를 자체적으로 해결하기 위해 IPv4에서는 NAT을 비롯한 다양한 솔루션을 내놓고 있지만, 점점 더 복잡해지는 구성 방법과 End to End 지원이라는 문제에 부딪친 상태입니다. 또한 이런 방법으로도 주소 부족은 점점 더 심화되고 있습니다.

따라서 기존 IPv4를 대체하면서도 훨씬 개선된 새로운 IP 방식이 필요하게 되었는데, 그건 바로 다음 시간부터 자세히 알아볼 IP version 6입니다.



## IPv6의 탄생

지난 시간의 IPv4의 눈물겨운 주소 아껴쓰기 이야기에 이어 이번 시간에는 어떻게 해서 IPv6가 탄생하게 되었는지부터 알아보도록 하겠습니다.

1990년, 그러니까 그 당시는 우리에겐 아직 인터넷이란 것도 낯설던 시절이죠, 겨우 천리안 정도를 누비고 다니던 그런 시절이었습니다.

바로 이 해에 IETF(Internet Engineering Task Force)에서는 벌써 클래스 B 주소가 1994년쯤에는 고갈될 것이라고 예상했다고 합니다. (이때 이미 IP 주소의 부족을 예견햇다니 역시 세상엔 똑똑한 사람이 꽤나 많은 모양입니다.)

그리고 다음 해인 1991년 11월 IETF는 산타페에서 열린 IETF 미팅에서 이 문제를 해결하기 위해 ROAD(ROuting and ADdress) 그룹을 만들게 됩니다. 그리고 1995년 IPNG(IP Next Generation) Workgroup이 'RFC 1883'이라는 첫 번째 세부안을 내놓게 됩니다. 이게 바로 IPv6의 근간이 되었다고 전해집니다.

다음 해인 1996년 IPv6의 테스트베드인 6Bone이 인터넷을 통해 시작됩니다. 6Bone은 뒤에 다시 설명하겠지만, IPv6의 운용을 테스트하기 위해 만든 망입니다. 즉 현재 우리가 사용하고 있는 IPv4망에는 영향을 주지 않으면서 IPv6에 대한 여러 가지 실험을 해볼 수 있도록 만들어놓은 IPv6의 망이라고 생각하시면 됩니다.  
우리나라를 포함해서 전 세계 57개국 1,100개 이상의 사이트가 이 망에 연결되어 테스트를 했었답니다. 하지만 이 망이 만들어진 목적이 테스트인 만큼 이 망은 2006년 6월 6일을 기해서 철거(?)하기로 했다고 합니다. 그리고 그동안 사용하던 주소 영역은 IANA(Internet Assigned Numbers Authority)로 다시 반납했다고 하네요. (아무래도 테스트망이 더 필요 없었나 봅니다. 그것도 2006년 6월 6일이라고 정한 걸 보면 역시 6을 상당히 강조한 느낌이 들죠?)

그리고 1999년 IPv6 포럼이 발족하게 됩니다. 이 포럼에서는 IPv6에 대한 여러 가지 기능을 협의하고 표준에 대한 의견을 수렴하는 역할을 하고 있습니다.

현재는 거의 모든 네트워크 제품 벤더들이 IPv6의 기능을 자사 제품에 탑재하고 있을 정도로 이제 IPv6는 더 이상 미래의 이야기가 아니라 바로 눈앞에 닥친, 아니 벌써 우리 곁에서 진행되고 있는 현실입니다.

어떠세요? 이제 IPv6에 대한 전반적인 역사가 이해가세요? 이렇게 역사공부 같은 지루한 이야기를 소개해 드린 건 우리가 모르는 사이에도 이 세상에선 정말 많은 변화가 일어나고 있었다는 것을 같이 느껴보자는 의미에서였답니다. 벌써 20년도 전에 시작된 IPv6에 대한 연구가 이제 결실을 맺기 시작한 거네요.



## 왜 갑자기 IPv4에서 IPv6로 뛰었을까요?

자, 여기서 문제 하나!

그럼 IPv5는 있을까요? 그동안 쓰던 게 IPv4였는데 왜 갑자기 IPv5를 건너뛰고 IPv6으로 갔을까요?

일단 정답부터 말씀드리자면 IPv5는 있습니다. IPv5는 한마디로 QoS(Quality of Service) 제공을 위한 실험적인 Resource Reservation Protocol로써 Internet Stream Protocol(ST)로 정의됩니다.

무슨 말이냐구요?

다시 말씀드리자면 IPv5는 인터넷과 같은 곳에서 디지털 사운드나 멀티미디어 데이터와 같은 리얼타임 데이터를 효과적으로 전송하기 위해 만들어진 프로토콜이라는 겁니다. IPv5는 네트워크 경로 위에 리얼타임 스트리밍 데이터를 보낼 때를 대비해서 네트워크 자원(Resource)을 예약(Reserve)해둘 수 있기 때문에 다른 자동차들이 아무리 많이 다녀도 시원하게 뻥뻥 뚫니는 버스 전용차로처럼, 자신만의 네트워크 자원을 가지고 전송이 가능하게 되는 겁니다. 이래야 소리나 영상 같은 데이터가 끊어지지 않고 부드럽게 전송될 수 있겠죠?

꽤나 좋은 프로토콜이긴 하지만, IPv5는 IPv4와 공존하면서 상호작용을 하도록 디자인된 프로토콜로, IPv4를 대체하기 위한 프로토콜은 아닙니다. 실제로도 IPv4와 IPv5는 동일한 주소 구조를 가지고 있기 때문에 IPv6와는 차원이 다르다고 볼 수 있습니다.

다만 IPv4와 IPv5의 차이점은 패킷의 첫 번째 4비트 부분인 IP Version Number가 다르다는 것뿐입니다. 하나는 4, 하나는 5.

1970년대 말기에 만들어진 IPv5로 알려진 프로토콜은 이제 RSVP(Resource Reservation Protocol)과 같은 비슷한 역할을 하는 다른 프로토콜이 나오면서 그 쓰임새가 많이 줄었다고 합니다. 그래도 이런 프로토콜이 있었구나... 하는 것 정도는 알아두시는 것도 좋겠죠?

IPv5/ST Protocol에 대한 좀 더 자세한 설명이 알고 싶으신 분은 RFC1190과 RFC1819를 참고 하시기 바랍니다.



## IPv6에서 무엇이 달라졌냐고 묻는다면...

그럼 이제 IPv5에 대한 걱정이나 미안함 같은 건 털어버리시구요. 바로 IPv6에 대해 알아보도록 하겠습니다. 이제부터가 진짜 IPv6에 대한 여행이니 이제부턴 안전벨트 단단히 매고 전속력으로 따라오시기 바랍니다.

그럼 먼저 IPv6의 특징에 대해 간단히 살펴봅시다.

먼저 가장 큰 특징은 뭘까요? 아시죠?? 바로 확~ 넓어진 주소 공간입니다. 이렇게 주소 공간이 넓어진 것은 주소 부족의 문제를 해결하는 것뿐만 아니라 여러 가지를 가능하게 해줍니다. 그게 뭐냐구요?

전문 용어로 알아보자면,

먼저 Global Address입니다. 말 그대로 주소의 겹침 없이 전 세계적으로 유일한 주소를 마음놓고 쓸 수 있다는 것입니다. TV를 보면 요즘 같은 시대에 꼭 필요한 인재상을 글로벌 인재라고 하죠? 전 세계 어디에서도 경쟁력을 갖춘 사람... 뭐 이런 인재가 필요하다는 이야긴데 IP 주소도 이제 글로벌 주소시대에 왔나 봅니다.  
이렇게 글로벌 주소를 갖게 되면 Flexibility, 즉 주소 배정에 융통성이 가능해지고, 주소를 체계적으로 배정할 수 있어서 나중에 주소를 집합해서 하나의 주소를 만드는 Aggregation(묶어준다는 거죠?)을 효과적으로 수행해 줄 수 있으며, 한 경로 또는 장비의 문제시 끊기는 현상이 없는 전송을 위한 Multi-homing(멀티호밍, 그러니까 집이 여러 곳이다? 뭐 그런 의미로, 한 곳에 문제가 생겼을 때 돌아갈 곳을 정해두는 방식이랍니다.) 역시 훨씬 편리하게 수행 가능해졌습니다.

자, 그럼 IPv6의 특징이 주소만 넓어진거냐?? 그건 아닙니다.

IP Header의 구조가 대폭 개선되었습니다. IP 헤더가 뭔지 아시죠? IP 패킷의 머리 부분(뒤에 가서 설명드리겠습니다.), 즉 여러 가지 정보를 담고 있는 헤더가 그동안은 무지 복잡해서 라우팅의 성능 개선이 어려웠는데, IPv6에서는 헤더의 정보를 간소화하고 효과적으로 배치해서 라우팅의 성능을 획기적으로 올릴 수 있게 했습니다.  
쉽게 IPv4에서는 머리가 복잡했는데, 이제 IPv6에서는 머리가 맑아져서 성능이 개선되었다... 라고 생각하시면 되겠네요.

또한 다양한 IPv4로부터 IPv6로의 이전 옵션을 제공하는데, 이는 어차피 아무리 IPv6가 좋아도 하루아침에 IPv4가 전부 IPv6로 넘어갈 수는 없기 때문에 한동안은 두 버전의 동거가 필요하게 됩니다.  
이때 IPv4와 IPv6 간의 다양한 전환기법이 제공되어야 IPv6로의 변경이 용이해지게 되어서 IPv6에서는 여러 가지 다양한 옵션의 전환 기능을 제공하게 됩니다.

자, 그럼 일단 여기서 잠깐 정리해볼까요?

"IPv6의 특징이 뭐냐?"라고 누군가 여러분께 묻는다면 넓어진 주소 공간, 간편해진 IP 헤더, 그리고 다양한 IPv4와의 호환 옵션이라고 자신 있게 이야기하시면 됩니다. 사실 좀 더 있는데 그 건 뒤에서...

이제 우리는 IPv6의 주요 기능에 대해서 간략하게 알아봤습니다.

그렇다면 이번 시간엔 구체적으로 IPv6의 주소 공간이 얼마나 넓어졌는지, 그리고 그 정도면 우리가 앞으로 천년만년 마음 놓고 쓸 수 있는 건지에 대해서 알아보겠습니다.

지난번 이떤 기사를 보니 IPv4와 IPv6의 주소를 비교하면서 주소 크기가 4배로 넓어졌다고 나와 있던데 이 글을 읽는 사람 입장에선 사용할 수 있는 주소 공간 역시 4배가 늘어났다고 오해 할 소지가 있겠죠?

아미 아시는 대로 IPv4의 주소 체계는 32비트였습니다. 그리고 IPv6의 주소 체계는 128비트입니다. 물론 비트수로 따지자면 크기가 4배 늘어난 거지만, 사용할 수 있는 주소의 차이는 어마어마합니다.

먼저 IPv4의 주소를 알아볼까요?

2<sup>32</sup>개를 다 쓴다고 가정했을 때 약 43억 개의 주소가 나옵니다. 하지만 이미 설명드린 대로 사용 가능한 주소는 2억 5,000만 개 정도라고 했죠.

그럼 이번엔 IPv6의 주소를 알아볼까요?

128비트 주소니까 만들어낼 수 있는 주소는 2<sup>128</sup>, 즉 계산해보면 3.4x10<sup>38</sup>개만큼의 주소 공간이 나옵니다.

340,282,366,920,938,463,463,374,607,431,768,211,456개의 주소가 가능한 것입니다.

지금까지의 수의 개념으로 보면 거의 무한대라고 해도 되겠죠?

만약 이 주소를 지구상에 존재하는 모든 사람들에게 나누어준다고 가정했을 때도 1인당 10<sub>28</sub>만큼의 주소(정확히 말씀드리자면 5,373x10<sub>28</sub> 정도입니다.)를 나누어줄 수 있다고 하니 이제 주소 부족에 대한 걱정은 잊으셔도 되겠습니다.

그냥 숫자로 설명하는 것보다 뭔가 비교를 해서 설명하면 이해가 쉬울 것 같아 잠시 IPv4 주소와 IPv6 주소를 비교해서 설명을 해볼까 합니다.

이런 가정을 하겠습니다. 만약 IP 주소 1개를 1그램(g)이라고 한다면 IPv4ㅇ레서 이론적으로 가능한 모든 주소를 더한 무게는 43억 그램이 되고, 이 무게는 뉴욕 맨해튼에 있는 엠파이어 스테이트 빌딩 무게의 1/85이라고 합니다. 볼까요?

일단 엠파이어 스테이트 빌딩은 102층이고, 무게는 36만 5,000톤이라고 합니다. 요걸 그램으로 바꿔야 계산이 되겠죠?
