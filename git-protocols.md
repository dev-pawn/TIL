# The Protocols

이제는 다른 사람과 협업하는 방법을 고민해보자.

다른 사람과 협업하기 위해선 리모트 저장소가 필요하다.

공동으로 사용할 수 있는 저장소를 만들고 모두 이 저장소에 접근하여 Push, Pull 할 수 있어야 한다.

Git 서버를 운영하는 건 매우 간단하다.

우선 사용할 전송 프로토콜부터 정한다.

Git은 Local, HTTP, SSH, Git 이렇게 네 가지의 프로토콜을 사용할 수 있다.

이 절에서는 각각 어떤 경우에 유용한지 살펴본다.

## 목차

- [로컬 프로토콜](#로컬-프로토콜)
- [HTTP 프로토콜](#http-프로토콜)



## 로컬 프로토콜

가장 기본적인 것이 __로컬 프로토콜__ 이다.

리모트 저장소가 단순히 같은 시스템의 다른 디렉토리에 있을때 사용한다.

팀원들이 전부 한 시스템에 로그인하여 개발하거나 아니면 NFS같은 것으로 파일시스템을 공유하고 있을 때 사용한다.

이런 상황은 문제가 될 수 있다. 모든 저장소가 한 시스템에 있기 때문에 한순간에 모두 잃을 수 있다.



공유 파일시스템을 마운트했을 때는 로컬 저장소를 사용하는 것처럼 Clone 하고 Push 하고 Pull 하면 된다.

일단 저장소를 Clone 하거나 프로젝트에 리모트 저장소로 추가한다.

추가할 때 URL 자리에 저장소의 경로를 사용한다. 예를 들어 아래와 같이 로컬 저장소를 Clone 한다.

```
$git clone /srv/git/project.git
```

또는 아래처럼도 가능하다.

```
$ git clone file:///srv/git/project.git
```

Git은 파일 경로를 직접 쓸 때와 ``file://`` 로 시작하는 URL을 사용할 때를 약간 다르게 처리한다.

디렉토리 경로를 그대로 사용하면 Git은 필요한 파일을 직접 복사하거나 하드 링크를 사용한다.

하지만 ``file://`` 로 시작하면 Git은 네트워크를 통해서 데이터를 전송할 때처럼 프로세스를 별도로 생성하여 처리한다.

이 프로세스로 데이터를 전송하는 것은 효율이 좀 떨어지지만 그래도 ``file://`` 를 사용하는 이유가 있다.

이것은 외부 Refs나 개체들이 포함된 저장소의 복사본을 깨끗한 상태로 남겨두고자 함이다.

보통은 다른 버전관리 시스템들에서 import한 후에 사용한다.

여기서는 속도가 빠른 디렉토리 경로를 사용한다.



이미 가진 Git 프로젝트에는 아래와 같이 로컬 저장소를 추가한다.

```
$ git remote add local_proj /srv/git/project.git
```

이렇게 하면 네트워크에 있는 리모트 저장소처럼 ``local_proj`` 이름으로 리모트처럼 Push 하거나 Pull 할 수 있다.



__장점__

파일 기반 저장소의 장점은 간단하다는 것이다.

기존에 있던 네트워크나 파일의 권한을 그대로 사용하기 때문에 설정하기 쉽다.

이미 팀 전체가 접근할 수 있는 파일시스템을 가지고 있다면 저장소를 아주 쉽게 구성할 수 있다.

다른 디렉토리를 공유할 때처럼 모든 동료가 읽고 쓸 수 있는 공유 디렉토리에 Bare 저장소를 만들면 된다.



또한, 동료가 작업하는 저장소에서 한 일을 바로 가져오기에도 좋다.

만약 함께 프로젝트를 하는 동료가 자신이 한 일을 당신이 확인해 줬으면 한다.

이럴 때 ``git pull /home/john/project`` 처럼 명령어를 실행시켜서 매우 쉽게 동료의 코드를 가져올 수 있다.

그 동료가 서버에 Push 하고 당신이 다시 Pull 할 필요없다.



__단점__

다양한 상황에서 접근할 수 있도록 디렉토리를 공유하는 것 자체가 일반적으로 어렵다.

집에 있을 때 Push 해야 하면 리모트 저장소가 있는 디스크를 마운트해야 하는데 이것은 다른 프로토콜을 이용하는 방법보다 느리고 어렵다.



게다가 파일시스템을 마운트해서 사용하는 중이라면 별로 빠르지도 않다.

로컬 저장소는 데이터를 빠르게 읽을 수 있을 때만 빠르다. NFS에 있는 저장소에 Git을 사용하는 것은 보통 같은 서버에 SSH로 접근하는 것보다 느리다.



마지막으로 이 프로토콜은 저장소에 우발적인 사고가 발생하지 않도록 보호해주지 않는다.

모든 사용자는 쉘에서 ``리모트`` 디렉토리에 무슨 짓이든지 할 수 있다.

누군가 저장소에 침범해서 Git 내부 파일 삭제하고 변경하지 못하도록 하는 장치가 없다.



## HTTP 프로토콜



## 참고 자료

Pro Git Book: https://git-scm.com/book/ko/v2/Git-%EC%84%9C%EB%B2%84-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C#