# Appendix-C 가변인자 함수에 대한 이해

가변인자 함수를 소개하는 이유는 printf와 scanf 계열의 함수 선언을 이해할 수 있도록 돕는데 있다.



> printf 함수와 scanf 함수의 사용 방법을 생각해 보면

printf 함수와 scanf 함수의 공통점은 다음과 같다.

__첫 번째 전달인자인 문자열에 존재하는 서식문자의 수만큼 전달인자의 수도 증가한다.__

즉, printf 함수와 scanf 함수는 전달인자의 수가 제한되어 있지 않다는 특징이 있다. 그렇다면 우리도 다음과 같은 형태의 호출이 가능한 함수를 정의할 수 있지 않을까(함수 Sum의 첫 번째 전달인자는 이후에 전달되는 인자의 갯수정보이다)?

- num = Sum(2, 1, 2);					// 1과 2의 합
- num = Sum(3, 1, 2, 3);	            // 1과 2와 3의 합
- num = Sum(4, 1, 2, 3, 4);            // 1, 2, 3 그리고 4의 합

Sum과 같은 형태의 호출이 가능한 함수를 가리켜 '가변인자 함수'라 하는데, 이 함수에 대한 모든 것은 헤더파일 stdarg.h에 선언되어 있다.  
따라서 stdarg.h에 선언된 내용들을 이해하면, 위와 같은 방식으로 호출 가능한 Sum 함수를 정의할 수 있다.



> 가변인자 매개변수의 선언방법

매개변수 선언을 통해서 함수호출 시 전달되어야 할 인자의 수와 자료형이 결정된다. 그런데 가변인자 함수는 호출이 될 때 비로소 인자의 수가 결정되기 때문에 다음 예제에서 보이는 형태대로 정의되어야 한다.

```c
#include <stdio.h>
int Sum(int n, ...);

int main(void)
{
    Sum(2, 1, 2);
    Sum(3, 1, 2, 3);
    Sum(4, 1, 2, 3, 4);
    return 0;
}

int Sum(int n, ...)			// ... 은 가변인자에 대한 선언
{
    printf("n=%d \n", n);
    return 0;
}
```



실행결과

```
n=2
n=3
n=4
```



위 예제를 통해서 가변인자에 대한 매개변수의 선언방식을 이해했으니, 이제 가변인자의 정보 추출방법을 살펴봐야 한다.  
위 예제에서는 인자의 전달방법만 설명했을 뿐, 전달된 인자의 참조방법은 보여주지 않고 있다.



> 전달된 인자들을 어떻게 추출해 내나요?

가변인자 함수의 호출을 통해서 전달되는 인자정보를 추출하기 위해서는 다음의 단계를 거쳐야 한다.

- 단계 1: 가변인자를 가리킬 수 있는 참조자를 선언한다.
- 단계 2: 참조자가 가변인자를 실제로 참조할 수 있도록 한다.
- 단계 3: 참조자를 통해 전달된 정보를 추출한다.
- 단계 4: 참조자가 더 이상 가변인자를 가리키지 않도록 해제한다.

그리고 각각의 기능을 제공하는 함수의 이름과 참조자의 자료형은 다음과 같으며, 이들을 사용하기 위해서는 헤더파일 stdarg.h.를 포함해야 한다.

- 단계 1: va_list
- 단계 2: va_start
- 단계 3: va_arg
- 단계 4: va_end

그럼 예제를 통해서 자세한 내용을 설명하겠다. 가변인자의 추출방법은 예제를 참조하는 것이 이해가 빠르다.

```c
#include <stdio.h>
#include <stdarg.h>
int Sum(int n, ...);
    
int main(void)
{
    printf("1+2-%d \n", Sum(2, 1, 2));
    printf("1+2+3=%d \n", Sum(3, 1, 2, 3));
    printf("1+2+3+4=%d \n", Sum(4, 1, 2, 3, 4));
    return 0;
}

int Sum(int n, ...)
{
    int sum = 0;
    int i;
    va_list vlist;				// 단계1: 가변인자의 참조자 선언
    
    va_start(vlist, n);				// 단계2: 참조 대상과 범위 지정
    for(i=0; i<n; i++)
        sum+=va_arg(vlist, int);		// 단계3: 값의 추출
    
    va_end(vlist);			// 단계4: 해 제
    return sum;
}
```



실행 결과

```
1+2=3
1+2+3=6
1+2+3+4=10
```

